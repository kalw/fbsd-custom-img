# Cirrus CI configuration for FreeBSD custom image builder
freebsd_instance:
  image_family: freebsd-15-0-amd64-ufs

task:
  name: Non Release Build
  only_if: $CIRRUS_BRANCH != 'main'
  env:
    FREEBSD_VERSIONS: "13.5,14.3"
    FREEBSD_ARCHS: "amd64/amd64,arm64/aarch64"
  script: |
    sh -x ./make.iso.with.installer.sh
  artifacts:
    path: artifacts/*.img

task:
  name: Release Build
  only_if: $CIRRUS_BRANCH == 'main'
  env:
    CIRRUS_CLONE_TAGS: true
    CIRRUS_CLONE_DEPTH: 0
    GH_TOKEN: ENCRYPTED[!98aa8e375d86d9841967a09d3e24653f253ee217b0f72782bcf6162770ddb04637829ddb34c574338f7cbd76dcf14ab5!]
  script: |
    pkg install -y curl gh cocogitto git-lite
    cog bump --auto --skip-ci
  artifacts:
    path: artifacts/*.img
